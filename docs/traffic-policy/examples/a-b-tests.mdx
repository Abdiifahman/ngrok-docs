---
title: A/B Test Example
sidebar_label: A/B Tests
---

import ConfigExample from "/src/components/ConfigExample.tsx";

You can run simple A/B tests with Traffic Policy using the [`rand.double()` macro](/docs/traffic-policy/macros/utility#randdouble--double). By setting its value to `>=0.5`, you can equally split incoming requests to two different internal agent endpoints.

:::tip
The value doesn't have to be `>=0.5`. You can adjust the value to split the traffic in different ratios. For example,`>=0.8` would send 80% of the traffic to one endpoint and 20% to the other.
:::

<ConfigExample
	config={{
		on_http_request: [
			{
                expressions: ["rand.double() <= 0.5"],
				actions: [
					{
						type: "forward-internal",
						config: {
							url: 'https://a.internal',
						},
					},
					{
						type: "forward-internal",
						config: {
							url: 'https://b.internal',
						},
					},
				],
			},
		],
	}}
/>

You can also route B traffic to a separate route.

<ConfigExample
	config={{
		on_http_request: [
			{
                expressions: ["rand.double() <= 0.5"],
				actions: [
					{
						type: "url-rewrite",
						config: {
							from: "/path/to/test",
                            to: "/path/to/test-b"
						},
					},
				],
			},
		],
	}}
/>

See [URL Rewrite Example](/docs/traffic-policy/examples/url-rewrites) for another example using rewrites.
```