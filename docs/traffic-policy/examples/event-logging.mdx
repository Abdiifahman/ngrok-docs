---
title: Event Logging Example
sidebar_label: Event Logging
---

import TabItem from "@theme/TabItem";
import Tabs from "@theme/Tabs";
import ConfigExample from "/src/components/ConfigExample.tsx";

With Traffic Policy, you can connect your API to ngrok's [event logging system](/docs/obs/) for smarter troubleshooting, testing, and integration of logging services like Datadog for your API gateway and upstream services.

This rule:

1. Checks if the response status code is not in the 200 range
1. Logs the unsuccessful request with a custom message and metadata

<Tabs groupId="exampleType" queryString="type" defaultValue="snippet">

<TabItem value="snippet" label="Snippet">

<ConfigExample
	config={{
		on_http_response: [
			{
				name: "Log unsuccessful requests",
				expressions: ["res.status_code < '200' && res.status_code >= '300'"],
				actions: [
					{
						type: "log",
						config: {
							metadata: {
								message: "Unsuccessful request",
								edge_id: "<YOUR-NGROK-DOMAIN>",
								success: false,
							},
						},
					},
				],
			},
		],
	}}
/>

</TabItem>

<TabItem value="full" label="Full Configuration File">

```yaml mode=traffic-policy title="config.yml"
endpoints:
	- name: my-agent-endpoint
	- description: My first Agent Endpoint with a Traffic Policy
	- upstream:
		- url: 80
	- traffic_policy:
		on_http_response:
		- name: Log unsuccessful requests
				expressions:
				- res.status_code < '200' && res.status_code >= '300'
				actions:
				- type: log
						config:
						metadata:
								message: Unsuccessful request
								edge_id: <YOUR-NGROK-DOMAIN>
								success: false
```

</TabItem>

</Tabs>

See [the `log` Traffic Policy action docs](/traffic-policy/actions/log/) for more information.
